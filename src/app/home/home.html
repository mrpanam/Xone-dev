<div class="container-fluid p-0 min-vh-100">
  <div class="row g-0">
    <!-- Left Sidebar -->
    <div class="col-md-3 col-lg-2 d-md-block text-white sidebar">
      <div class="position-sticky pt-3">
        <div class="text-center mb-4">
          <img [src]="user.avatar" class="rounded-circle mb-3" width="100" alt="User Avatar">
          <h5 class="mb-1">{{ user.name }}</h5>
          <div class="text-muted small mb-3">Level {{ user.level }} Trader</div>
          <div class="d-flex justify-content-center align-items-center mb-3">
            <span class="text-warning me-1">â˜…</span>
            <span class="me-2">{{ user.rating | number:'1.1-1' }}</span>
            <span class="badge bg-primary">{{ user.tradesCompleted }} Trades</span>
          </div>
          <div class="balance-display p-3 rounded" style="background-color: rgba(0, 0, 0, 0.2);">
            <div class="text-muted small">Available Balance</div>
            <h4 class="mb-0">{{ user.balance | currency:'USD':'symbol':'1.2-2' }}</h4>
          </div>
        </div>
        
        <ul class="nav flex-column">
          <li class="nav-item">
            <a class="nav-link active" href="#">
              <i class="bi bi-speedometer2 me-2"></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="bi bi-wallet2 me-2"></i>My Wallet
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="bi bi-graph-up me-2"></i>Analytics
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="bi bi-gear me-2"></i>Settings
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9 col-lg-10 ms-sm-auto px-4 py-4">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Portfolio Dashboard</h1>
      </div>
  
  <div class="row g-4">
    <!-- Total PnL Card -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title text-muted mb-3">Total Assets</h5>
          <div class="d-flex align-items-center">
            <div class="display-4 fw-bold">
            {{ totalAssets | currency:'USD' }}              
            </div>
            <div class="ms-3">
              <div class="text-muted small">Current Value</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Total Assets Card -->
    <div class="col-md-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title text-muted mb-3">Total Profit/Loss </h5>
          <div class="d-flex align-items-center">
            <div class="display-4 fw-bold" [ngClass]="{
              'text-success': totalPnL > 0,
              'text-danger': totalPnL < 0,
              'text-muted': totalPnL === 0
            }">
              {{ totalPnL | currency:'USD' }}
            </div>
            <div class="ms-3">
              <div class="text-muted small">All Time</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Top 5 Stocks Card -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-white border-bottom-0 py-3">
          <h5 class="mb-0 fw-bold">
            <i class="bi bi-graph-up me-2"></i>Top 5 Active Stocks
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <div class="chart-container" style="position: relative; height: 300px;">
                <canvas #stocksChart></canvas>
              </div>
            </div>
            <div class="col-md-4">
              <div class="list-group">
                @for (stock of topStocks; track stock.symbol) {
                  <div class="list-group-item border-0 py-2">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <h6 class="mb-0 fw-bold">{{ stock.symbol }}</h6>
                        <small class="text-muted">{{ stock.currentPrice | currency:'USD' }}</small>
                      </div>
                      <span class="badge" [ngClass]="{
                        'bg-success bg-opacity-10 text-success': stock.change > 0,
                        'bg-danger bg-opacity-10 text-danger': stock.change < 0,
                        'bg-secondary bg-opacity-10 text-secondary': stock.change === 0
                      }">
                        <i class="bi" [class.bi-arrow-up]="stock.change > 0" [class.bi-arrow-down]="stock.change < 0"></i>
                        {{ stock.change | number:'1.2-2' }}%
                      </span>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Trades Card -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-header bg-white border-bottom-0 py-3">
          <h5 class="mb-0 fw-bold">
            <i class="bi bi-clock-history me-2"></i>Recent Trades
          </h5>
        </div>
        <div class="card-body p-0">
          @if (recentTrades.length === 0) {
            <div class="text-center py-5 text-muted">
              <i class="bi bi-inbox fs-1"></i>
              <p class="mt-2 mb-0">No recent trades found</p>
            </div>
          } @else {
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                  <tr>
                    <th>Symbol</th>
                    <th class="text-end">Qty</th>
                    <th class="text-end">Price</th>
                    <th class="text-end">P/L</th>
                    <th class="text-center">Status</th>
                  </tr>
                </thead>
                <tbody>
                  @for (trade of recentTrades; track trade.id) {
                    <tr>
                      <td class="fw-semibold">{{ trade.symbol }}</td>
                      <td class="text-end">{{ trade.quantity | number:'1.2-2' }}</td>
                      <td class="text-end">{{ trade.current_price | currency:'USD' }}</td>
                      <td class="text-end fw-medium" [ngClass]="{
                        'text-success': (trade.current_price - trade.bought_price) * trade.quantity > 0,
                        'text-danger': (trade.current_price - trade.bought_price) * trade.quantity < 0
                      }">
                        {{ (trade.current_price - trade.bought_price) * trade.quantity | currency:'USD' }}
                      </td>
                      <td class="text-center">
                        <span class="badge" [ngClass]="{
                          'bg-success bg-opacity-10 text-success': trade.status && trade.status.toLowerCase() === 'open',
                          'bg-danger bg-opacity-10 text-danger': trade.status && trade.status.toLowerCase() === 'closed',
                          'bg-warning bg-opacity-10 text-warning': !trade.status || !['open', 'closed'].includes(trade.status.toLowerCase())
                        }">
                          {{ trade.status || 'N/A' }}
                        </span>
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
